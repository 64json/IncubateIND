var customDir = "";
var imgDir = customDir + "img/";

$.ajaxSetup({
    cache: false
});

$.getJSON(customDir + "customize.json", function (custom) {
    customize(custom);
    init(custom);
});

function customize(cs, prefix, $parent) {
    if ('undefined' === typeof prefix) prefix = '';
    if ('undefined' === typeof $parent) $parent = $(document);
    var keys = Object.keys(cs);
    $.each(keys, function (index, key) {
        var $element = $parent.find('[data-cs=' + prefix + key + ']');
        separate($element, prefix, key, cs[key]);
    });
}

function separate($element, prefix, key, value) {
    switch (typeof value) {
        case 'object':
            if (value instanceof Array) {
                $.each(value, function (index, obj) {
                    separate($element, prefix, key, obj);
                });
                break;
            }
            var type = value.$type;
            if (!type) {
                customize(value, prefix + key + '-');
                break;
            }
            var options = value.$options;
            var value = value.$value;
        case 'string':
            process($element, prefix, key, type, value, options);
            break;
    }
}

function process($element, prefix, key, type, value, options) {
    if (!options) options = {};
    switch (type) {
        case 'class':
            $element.addClass(value);
            break;
        case 'theme':
            break;
        case 'image':
            $element.attr('src', imgDir + value);
            break;
        case 'parallax':
            $element.attr('src', imgDir + value);
            $element.parent().parallax();
            break;
        case 'link':
            $element.attr('href', value);
            break;
        case 'array_cols':
            var colsInRow = options.colsInRow || 2147483647;
            var $row;
            $.each(value, function (index, obj) {
                if (index % colsInRow == 0) {
                    $row = $element.children('.template.row').clone();
                    if (index + colsInRow < value.length) $row.css({'margin-bottom': 0});
                    $row.removeClass('template');
                    $element.append($row);
                }
                var temp_prefix = prefix + key + '-' + index;
                var $template = $row.children('.template.col').clone();
                $template.removeClass('template');
                $row.append($template);

                $template.attr('data-cs', temp_prefix);
                var classes = Object.keys(obj);
                $.each(classes, function (index, cls) {
                    $template.find('.' + cls).attr('data-cs', temp_prefix + '-' + cls);
                });
                customize(obj, temp_prefix + '-', $template);
            });
            break;
        case 'array_rows':
            $.each(value, function (index, obj) {
                var temp_prefix = prefix + key + '-' + index;
                var $template = $element.children('.template.row').clone();
                $template.removeClass('template');
                $element.append($template);

                $template.attr('data-cs', temp_prefix);
                var classes = Object.keys(obj);
                $.each(classes, function (index, cls) {
                    $template.find('.' + cls).attr('data-cs', temp_prefix + '-' + cls);
                });
                customize(obj, temp_prefix + '-', $template);
            });
            break;
        default:
            $element.html(value);
    }
}